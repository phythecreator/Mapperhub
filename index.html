<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Geomarkr - Inspired by Periphern & Mapchart</title>
  <style>
    /* Reset and base styles */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0; padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #111;
      color: #eee;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
    }
    a, button {
      font-family: inherit;
    }
    button {
      cursor: pointer;
    }
    /* Container */
    .container {
      max-width: 960px;
      margin: auto;
      padding: 1rem 2rem 3rem 2rem;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3rem;
    }
    header h1 {
      font-weight: 900;
      font-size: 2.5rem;
      color: #0f62fe;
      user-select: text;
    }
    nav button {
      background: transparent;
      border: 2px solid #0f62fe;
      color: #0f62fe;
      font-weight: 700;
      padding: 0.5rem 1.2rem;
      margin-left: 1rem;
      border-radius: 6px;
      transition: background 0.3s ease;
    }
    nav button:hover,
    nav button:focus {
      background: #0f62fe;
      color: white;
      outline: none;
    }
    /* Hero Section */
    .hero {
      text-align: center;
      margin-bottom: 3rem;
    }
    .hero h2 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: #0f62fe;
      user-select: text;
    }
    .hero p {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      color: #ccc;
      user-select: text;
    }
    .primary-btn {
      background: #0f62fe;
      color: white;
      border: none;
      padding: 1rem 3rem;
      font-size: 1.25rem;
      font-weight: 700;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(15, 98, 254, 0.6);
      transition: background 0.3s ease;
      user-select: none;
    }
    .primary-btn:hover,
    .primary-btn:focus {
      background: #0049b7;
      outline: none;
    }
    /* Tutorial Section */
    .tutorial {
      background: #222;
      padding: 1.5rem 2rem;
      border-radius: 10px;
      max-width: 600px;
      margin: 0 auto;
      user-select: text;
    }
    .tutorial h3 {
      margin-top: 0;
      color: #0f62fe;
    }
    .tutorial ol {
      padding-left: 1.5rem;
    }
    .tutorial li {
      margin-bottom: 0.7rem;
      font-size: 1rem;
      color: #ddd;
    }
    /* Footer */
    footer {
      text-align: center;
      margin-top: 4rem;
      font-size: 0.9rem;
      color: #444;
      user-select: text;
    }
    /* Choose Map */
    .map-list {
      margin-top: 1rem;
    }
    .map-list button {
      display: block;
      width: 100%;
      padding: 1rem;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
      text-align: left;
      border-radius: 6px;
      border: 2px solid #333;
      background: transparent;
      color: #eee;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .map-list button.selected {
      border-color: #0f62fe;
      background: #0f62fe;
      color: white;
    }
    .map-list button:hover {
      background: #0f62fe;
      color: white;
    }
    .choose-footer {
      margin-top: 1.5rem;
      text-align: center;
    }
    .choose-footer button {
      background: #0f62fe;
      color: white;
      border: none;
      padding: 1rem 2rem;
      font-size: 1.1rem;
      font-weight: 700;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
      user-select: none;
    }
    .choose-footer button:disabled {
      background: #444;
      cursor: not-allowed;
      opacity: 0.6;
    }
    /* Editor */
    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .editor-header h1 {
      color: #0f62fe;
      user-select: text;
    }
    .editor-header button {
      background: transparent;
      border: none;
      color: #0f62fe;
      font-size: 1rem;
      cursor: pointer;
      user-select: none;
    }
    .editor-header button:hover,
    .editor-header button:focus {
      text-decoration: underline;
      outline: none;
    }
    .editor-toolbar {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }
    .color-picker {
      display: flex;
      gap: 0.3rem;
    }
    .color-swatch {
      width: 30px;
      height: 30px;
      border-radius: 6px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.3s ease;
      user-select: none;
    }
    .color-swatch.selected {
      border-color: white;
    }
    .zoom-controls button {
      background: #0f62fe;
      border: none;
      color: white;
      font-size: 1.3rem;
      padding: 0.3rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s ease;
    }
    .zoom-controls button:hover,
    .zoom-controls button:focus {
      background: #0049b7;
      outline: none;
    }
    .search-input {
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      border: 1px solid #333;
      font-size: 1rem;
      background: #111;
      color: white;
      user-select: text;
    }
    .svg-container {
      border: 1px solid #333;
      border-radius: 10px;
      overflow: hidden;
      user-select: none;
      touch-action: none;
      background: white;
      margin-top: 1rem;
      max-width: 100%;
      max-height: 600px;
      box-shadow: 0 0 10px rgb(15 98 254 / 0.4);
    }
    svg {
      display: block;
      max-width: 100%;
      height: auto;
      user-select: none;
    }
    .region-path {
      cursor: pointer;
      transition: fill 0.3s ease;
      stroke: #333;
      stroke-width: 1.2;
    }
    .region-path:hover {
      stroke: #0f62fe;
      stroke-width: 2;
    }
    .export-buttons button {
      background: #0f62fe;
      border: none;
      color: white;
      padding: 0.7rem 1.5rem;
      margin-right: 1rem;
      font-weight: 700;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
      user-select: none;
    }
    .export-buttons button:hover,
    .export-buttons button:focus {
      background: #0049b7;
      outline: none;
    }
    /* Scroll bar for map list */
    .map-list {
      max-height: 300px;
      overflow-y: auto;
    }
    /* Scrollbar styling */
    .map-list::-webkit-scrollbar {
      width: 8px;
    }
    .map-list::-webkit-scrollbar-thumb {
      background-color: #0f62fe;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React and ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX in browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">

    const { useState, useEffect, useRef } = React;

    // Colors inspired by Periphern palette
    const COLORS = [
      "#0f62fe",
      "#393939",
      "#f4f4f4",
      "#8a8a8a",
      "#d0d0d0",
      "#6f6f6f",
      "#ff7f50",
      "#6a5acd",
      "#20b2aa",
      "#ff6347",
    ];

    // Basic maps data with mock SVG paths
    // For demo, simple shapes represent countries/regions
    const MAPS = [
      {
        id: "world",
        name: "World",
        regions: [
          { id: "na", name: "North America", d: "M10,50 L110,50 L110,150 L10,150 Z" },
          { id: "sa", name: "South America", d: "M120,150 L210,150 L210,250 L120,250 Z" },
          { id: "eu", name: "Europe", d: "M220,40 L310,40 L310,120 L220,120 Z" },
          { id: "af", name: "Africa", d: "M220,130 L310,130 L310,220 L220,220 Z" },
          { id: "as", name: "Asia", d: "M320,30 L410,30 L410,140 L320,140 Z" },
          { id: "au", name: "Australia", d: "M320,150 L400,150 L400,230 L320,230 Z" },
        ],
      },
      {
        id: "europe",
        name: "Europe",
        regions: [
          { id: "fr", name: "France", d: "M20,20 L90,20 L90,80 L20,80 Z" },
          { id: "de", name: "Germany", d: "M100,20 L170,20 L170,80 L100,80 Z" },
          { id: "uk", name: "United Kingdom", d: "M180,10 L230,10 L230,60 L180,60 Z" },
          { id: "it", name: "Italy", d: "M100,90 L150,90 L150,130 L100,130 Z" },
        ],
      },
      {
        id: "africa",
        name: "Africa",
        regions: [
          { id: "eg", name: "Egypt", d: "M30,20 L90,20 L90,70 L30,70 Z" },
          { id: "ng", name: "Nigeria", d: "M100,30 L170,30 L170,80 L100,80 Z" },
          { id: "za", name: "South Africa", d: "M60,90 L140,90 L140,130 L60,130 Z" },
        ],
      },
      {
        id: "asia",
        name: "Asia",
        regions: [
          { id: "cn", name: "China", d: "M40,20 L110,20 L110,80 L40,80 Z" },
          { id: "in", name: "India", d: "M120,20 L180,20 L180,90 L120,90 Z" },
          { id: "jp", name: "Japan", d: "M190,20 L230,20 L230,60 L190,60 Z" },
        ],
      },
    ];

    // Utility to download SVG or PNG
    function downloadURI(uri, name) {
      const link = document.createElement("a");
      link.download = name;
      link.href = uri;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function App() {
      const [page, setPage] = useState("home"); // home, chooseMap, editor
      const [selectedMapId, setSelectedMapId] = useState(null);
      const [searchTerm, setSearchTerm] = useState("");
      const [selectedColor, setSelectedColor] = useState(COLORS[0]);
      const [regionColors, setRegionColors] = useState({});
      const [zoom, setZoom] = useState(1);
      const svgRef = useRef(null);

      const selectedMap = MAPS.find(m => m.id === selectedMapId);

      // Reset selections when changing maps or pages
      useEffect(() => {
        setRegionColors({});
        setZoom(1);
        setSelectedColor(COLORS[0]);
      }, [selectedMapId]);

      // Filter maps by search
      const filteredMaps = MAPS.filter(map =>
        map.name.toLowerCase().includes(searchTerm.toLowerCase())
      );

      // Handlers
      function toggleRegionColor(id) {
        setRegionColors(prev => {
          const currentColor = prev[id];
          if (currentColor === selectedColor) {
            // Remove color if clicked twice
            const newColors = { ...prev };
            delete newColors[id];
            return newColors;
          }
          return { ...prev, [id]: selectedColor };
        });
      }

      function handleExportSVG() {
        if (!svgRef.current) return;
        const svgData = new XMLSerializer().serializeToString(svgRef.current);
        const svgBlob = new Blob([svgData], { type: "image/svg+xml;charset=utf-8" });
        const url = URL.createObjectURL(svgBlob);
        downloadURI(url, `${selectedMap.name}_map.svg`);
        URL.revokeObjectURL(url);
      }

      function handleExportPNG() {
        if (!svgRef.current) return;

        const svgData = new XMLSerializer().serializeToString(svgRef.current);
        const canvas = document.createElement("canvas");
        const bbox = svgRef.current.getBBox();

        canvas.width = bbox.width * zoom;
        canvas.height = bbox.height * zoom;

        const ctx = canvas.getContext("2d");
        const img = new Image();

        const svgBlob = new Blob([svgData], { type: "image/svg+xml;charset=utf-8" });
        const url = URL.createObjectURL(svgBlob);

        img.onload = function () {
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          URL.revokeObjectURL(url);
          canvas.toBlob((blob) => {
            if (!blob) return;
            const blobUrl = URL.createObjectURL(blob);
            downloadURI(blobUrl, `${selectedMap.name}_map.png`);
            URL.revokeObjectURL(blobUrl);
          });
        };
        img.src = url;
      }

      // Zoom controls
      function zoomIn() {
        setZoom(prev => Math.min(prev + 0.25, 3));
      }
      function zoomOut() {
        setZoom(prev => Math.max(prev - 0.25, 0.5));
      }
      function resetZoom() {
        setZoom(1);
      }

      // Pages
      if (page === "home") {
        return (
          <div className="container" role="main" aria-label="Landing page">
            <header>
              <h1>Geomarkr</h1>
              <nav>
                <button onClick={() => alert("Create Account not implemented")}>Create Account</button>
                <button onClick={() => alert("Login not implemented")}>Login</button>
              </nav>
            </header>

            <section className="hero">
              <h2>Create custom maps easily</h2>
              <p>Visualize data on maps by coloring countries, states, or continents.</p>
              <button
                className="primary-btn"
                onClick={() => setPage("chooseMap")}
                aria-label="Create a new map"
              >
                Create Map
              </button>
            </section>

            <section className="tutorial" aria-label="How to use tutorial">
              <h3>How it works</h3>
              <ol>
                <li>Click "Create Map" to start</li>
                <li>Select a continent or country map</li>
                <li>Pick colors and click regions to color them</li>
                <li>Export your colored map as PNG or SVG</li>
              </ol>
            </section>

            <footer>
              <small>Made by @tugamapper - Inspired in Periphern and Mapchart.</small>
            </footer>
          </div>
        );
      }

      if (page === "chooseMap") {
        return (
          <div className="container" role="main" aria-label="Map selection page">
            <header>
              <h1>Choose a Map</h1>
              <button onClick={() => {
                setSelectedMapId(null);
                setSearchTerm("");
                setPage("home");
              }} aria-label="Back to Home">
                ← Back
              </button>
            </header>

            <input
              className="search-input"
              type="search"
              placeholder="Search continents or countries..."
              value={searchTerm}
              onChange={e => setSearchTerm(e.target.value)}
              aria-label="Search maps"
              autoFocus
            />

            <div className="map-list" role="list" aria-live="polite" aria-relevant="additions removals">
              {filteredMaps.length === 0 && <p>No maps found.</p>}
              {filteredMaps.map(map => (
                <button
                  key={map.id}
                  onClick={() => setSelectedMapId(map.id)}
                  className={selectedMapId === map.id ? "selected" : ""}
                  aria-pressed={selectedMapId === map.id}
                  role="listitem"
                >
                  {map.name}
                </button>
              ))}
            </div>

            <div className="choose-footer">
              <button
                disabled={!selectedMapId}
                onClick={() => setPage("editor")}
                aria-disabled={!selectedMapId}
              >
                Start Editing
              </button>
            </div>

            <footer>
              <small>Made by @tugamapper - Inspired in Periphern and Mapchart.</small>
            </footer>
          </div>
        );
      }

      if (page === "editor") {
        return (
          <div className="container" role="main" aria-label={`Editing map of ${selectedMap.name}`}>
            <header className="editor-header">
              <h1>{selectedMap.name} Map Editor</h1>
              <button onClick={() => setPage("chooseMap")} aria-label="Back to Map Selection">
                ← Back
              </button>
            </header>

            <div className="editor-toolbar" aria-label="Map editing controls">
              <div aria-label="Select color palette" role="radiogroup" tabIndex={-1}>
                <span style={{marginRight:"0.5rem", userSelect:"none"}}>Colors:</span>
                <div className="color-picker">
                  {COLORS.map((color) => (
                    <button
                      key={color}
                      className={`color-swatch ${selectedColor === color ? "selected" : ""}`}
                      style={{ backgroundColor: color }}
                      onClick={() => setSelectedColor(color)}
                      aria-checked={selectedColor === color}
                      role="radio"
                      aria-label={`Select color ${color}`}
                    />
                  ))}
                </div>
              </div>

              <div className="zoom-controls" role="group" aria-label="Zoom controls">
                <button onClick={zoomOut} aria-label="Zoom out">−</button>
                <button onClick={resetZoom} aria-label="Reset zoom">100%</button>
                <button onClick={zoomIn} aria-label="Zoom in">+</button>
              </div>
            </div>

            <div
              className="svg-container"
              style={{ transform: `scale(${zoom})`, transformOrigin: "top left" }}
              aria-label={`${selectedMap.name} map with clickable regions`}
              role="img"
            >
              <svg
                ref={svgRef}
                viewBox="0 0 420 260"
                xmlns="http://www.w3.org/2000/svg"
                aria-labelledby="svgTitle"
                role="img"
              >
                <title id="svgTitle">{selectedMap.name} Map</title>
                {selectedMap.regions.map(({ id, name, d }) => (
                  <path
                    key={id}
                    className="region-path"
                    d={d}
                    fill={regionColors[id] || "#ddd"}
                    onClick={() => toggleRegionColor(id)}
                    tabIndex={0}
                    onKeyDown={(e) => {
                      if (e.key === "Enter" || e.key === " ") {
                        e.preventDefault();
                        toggleRegionColor(id);
                      }
                    }}
                    aria-label={`Region ${name}, colored ${regionColors[id] || "default"}`}
                    role="button"
                  />
                ))}
              </svg>
            </div>

            <div className="export-buttons" style={{ marginTop: "1rem" }}>
              <button onClick={handleExportSVG} aria-label="Export map as SVG">Export SVG</button>
              <button onClick={handleExportPNG} aria-label="Export map as PNG">Export PNG</button>
            </div>

            <footer>
              <small>Made by @tugamapper - Inspired in Periphern and Mapchart.</small>
            </footer>
          </div>
        );
      }

      return null;
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);

  </script>
</body>
</html>
