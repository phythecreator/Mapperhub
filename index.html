<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Geomarkr - Create Custom Interactive Maps</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
  body { transition: background-color 0.3s ease, color 0.3s ease; }
  .area:hover { opacity: 0.8; cursor: pointer; transition: opacity 0.2s; }
  #svgMap { touch-action: none; user-select: none; }
</style>
</head>
<body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white font-sans min-h-screen flex flex-col">

<!-- INTRO / HERO -->
<header class="flex flex-col items-center justify-center py-20 px-6 text-center gap-4 bg-gradient-to-r from-blue-600 to-indigo-700 text-white">
  <div class="flex items-center space-x-3">
    <!-- LOGO SVG -->
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 64 64" class="drop-shadow-lg">
      <circle cx="32" cy="32" r="30" stroke="white" stroke-width="3" />
      <path d="M32 14 L42 32 L32 50 L22 32 Z" fill="white" />
      <text x="32" y="37" text-anchor="middle" font-family="Arial, sans-serif" font-weight="700" font-size="18" fill="#4F46E5" >GM</text>
    </svg>
    <h1 class="text-4xl font-extrabold select-none">Geomarkr</h1>
  </div>
  <p class="max-w-xl text-lg">Create custom interactive maps. Paint regions, add legends, zoom, and export in high quality.</p>
  <button onclick="document.getElementById('editor').scrollIntoView({behavior:'smooth'})"
    class="mt-6 bg-white text-indigo-700 font-semibold px-6 py-3 rounded-xl hover:bg-indigo-100 transition">
    Get Started
  </button>
</header>

<!-- CONTROLS & MAP -->
<section id="editor" class="flex-grow bg-gray-100 dark:bg-gray-800 p-8">
  <div class="max-w-6xl mx-auto flex flex-col md:flex-row gap-6">

    <!-- Controls Panel -->
    <aside class="w-full md:w-80 bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 flex flex-col gap-4 sticky top-6 h-max">

      <h2 class="text-2xl font-bold mb-4">Map Controls</h2>

      <label class="flex flex-col gap-1 font-medium">
        Current Color:
        <input type="color" id="colorPicker" value="#3b82f6" class="w-full h-10 rounded border" />
      </label>

      <button id="resetBtn" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded transition">Reset Colors</button>

      <button id="saveBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded transition">Save Map (JSON)</button>

      <button id="loadBtn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded transition">Load Map (JSON)</button>

      <input type="file" id="loadFileInput" accept="application/json" class="hidden" />

      <button id="exportPngBtn" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded transition">Export PNG</button>

      <button id="exportSvgBtn" class="w-full bg-green-800 hover:bg-green-900 text-white py-2 rounded transition">Export SVG</button>

      <button id="toggleThemeBtn" class="w-full bg-gray-700 hover:bg-gray-800 text-white py-2 rounded transition">Toggle Dark / Light Mode</button>

      <h3 class="mt-6 font-semibold text-lg">Legend</h3>
      <ul id="legendList" class="max-h-64 overflow-auto divide-y divide-gray-300 dark:divide-gray-700"></ul>
    </aside>

    <!-- Map Container -->
    <main class="flex-grow bg-white dark:bg-gray-900 rounded-lg shadow-lg p-4 relative select-none">

      <div id="mapWrapper" class="overflow-hidden touch-pan-y" style="width:100%; height:600px; position: relative;">

        <!-- SVG Map with zoom and drag -->
        <svg id="svgMap" viewBox="0 0 800 600" class="w-full h-full" style="user-select:none; touch-action:none;">
          <!-- Simplified Europe countries with ISO IDs -->
          <path id="PT" class="area" d="M100,300 L120,280 L140,300 L120,320 Z" fill="#ccc" />
          <path id="ES" class="area" d="M140,300 L160,280 L180,300 L160,320 Z" fill="#ccc" />
          <path id="FR" class="area" d="M180,300 L200,280 L220,300 L200,320 Z" fill="#ccc" />
          <path id="DE" class="area" d="M220,300 L240,280 L260,300 L240,320 Z" fill="#ccc" />
          <path id="IT" class="area" d="M260,300 L280,280 L300,300 L280,320 Z" fill="#ccc" />
        </svg>
      </div>
    </main>
  </div>
</section>

<script>
  const colorPicker = document.getElementById('colorPicker');
  const legendList = document.getElementById('legendList');
  const svgMap = document.getElementById('svgMap');
  const resetBtn = document.getElementById('resetBtn');
  const saveBtn = document.getElementById('saveBtn');
  const loadBtn = document.getElementById('loadBtn');
  const loadFileInput = document.getElementById('loadFileInput');
  const exportPngBtn = document.getElementById('exportPngBtn');
  const exportSvgBtn = document.getElementById('exportSvgBtn');
  const toggleThemeBtn = document.getElementById('toggleThemeBtn');
  const mapWrapper = document.getElementById('mapWrapper');

  // Map state: { regionId: color }
  let mapState = {};

  // Add or update legend entry
  function addToLegend(id, color) {
    let existing = legendList.querySelector(`li[data-id="${id}"]`);
    if(existing) {
      existing.querySelector('.color-box').style.background = color;
    } else {
      const li = document.createElement('li');
      li.dataset.id = id;
      li.className = 'flex items-center space-x-2 py-1';
      li.innerHTML = `
        <div class="color-box w-5 h-5 rounded border" style="background:${color}"></div>
        <span>${id}</span>
      `;
      legendList.appendChild(li);
    }
  }

  // Remove legend entry
  function removeFromLegend(id) {
    let existing = legendList.querySelector(`li[data-id="${id}"]`);
    if(existing) existing.remove();
  }

  // Update map fill and legend when region clicked
  svgMap.querySelectorAll('.area').forEach(area => {
    area.addEventListener('click', () => {
      const id = area.id;
      const color = colorPicker.value;
      area.setAttribute('fill', color);
      mapState[id] = color;
      addToLegend(id, color);
    });
  });

  // Reset map colors and legend
  resetBtn.addEventListener('click', () => {
    svgMap.querySelectorAll('.area').forEach(area => {
      area.setAttribute('fill', '#ccc');
    });
    mapState = {};
    legendList.innerHTML = '';
  });

  // Save map state as JSON
  saveBtn.addEventListener('click', () => {
    const dataStr = JSON.stringify(mapState, null, 2);
    const blob = new Blob([dataStr], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "geomarkr-map.json";
    a.click();
    URL.revokeObjectURL(url);
  });

  // Load map state from JSON
  loadBtn.addEventListener('click', () => {
    loadFileInput.click();
  });

  loadFileInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = event => {
      try {
        const data = JSON.parse(event.target.result);
        if(typeof data !== 'object') throw new Error('Invalid data');
        mapState = data;
        // Apply colors and update legend
        svgMap.querySelectorAll('.area').forEach(area => {
          const color = mapState[area.id] || '#ccc';
          area.setAttribute('fill', color);
          if(color !== '#ccc') addToLegend(area.id, color);
          else removeFromLegend(area.id);
        });
      } catch {
        alert('Failed to load map data. Invalid JSON.');
      }
    };
    reader.readAsText(file);
    e.target.value = ''; // Reset input
  });

  // Export PNG
  exportPngBtn.addEventListener('click', () => {
    html2canvas(mapWrapper, {backgroundColor: null, scale: 2}).then(canvas => {
      const link = document.createElement('a');
      link.download = 'geomarkr-map.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  });

  // Export SVG
  exportSvgBtn.addEventListener('click', () => {
    const serializer = new XMLSerializer();
    const source = serializer.serializeToString(svgMap);
    const blob = new Blob([source], {type: "image/svg+xml;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'geomarkr-map.svg';
    a.click();
    URL.revokeObjectURL(url);
  });

  // Dark/light mode toggle
  toggleThemeBtn.addEventListener('click', () => {
    if(document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('theme', 'light');
    } else {
      document.documentElement.classList.add('dark');
      localStorage.setItem('theme', 'dark');
    }
  });

  // Initialize theme from localStorage
  if(localStorage.getItem('theme') === 'dark') {
    document.documentElement.classList.add('dark');
  }

  // Simple zoom & drag on SVG
  let isDragging = false, startX, startY, startViewBox;
  svgMap.style.cursor = 'grab';
  svgMap.addEventListener('mousedown', e => {
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    const vb = svgMap.getAttribute('viewBox').split(' ').map(Number);
    startViewBox = {x: vb[0], y: vb[1], w: vb[2], h: vb[3]};
    svgMap.style.cursor = 'grabbing';
  });
  window.addEventListener('mouseup', () => {
    isDragging = false;
    svgMap.style.cursor = 'grab';
  });
  window.addEventListener('mousemove', e => {
    if(!isDragging) return;
    const dx = (startX - e.clientX) * (startViewBox.w / svgMap.clientWidth);
    const dy = (startY - e.clientY) * (startViewBox.h / svgMap.clientHeight);
    svgMap.setAttribute('viewBox', `${startViewBox.x + dx} ${startViewBox.y + dy} ${startViewBox.w} ${startViewBox.h}`);
  });
  // Zoom with wheel
  svgMap.addEventListener('wheel', e => {
    e.preventDefault();
    const scaleAmount = e.deltaY > 0 ? 1.1 : 0.9;
    const vb = svgMap.getAttribute('viewBox').split(' ').map(Number);
    const mx = (e.offsetX / svgMap.clientWidth) * vb[2] + vb[0];
    const my = (e.offsetY / svgMap.clientHeight) * vb[3] + vb[1];
    const newW = vb[2] * scaleAmount;
    const newH = vb[3] * scaleAmount;
    const newX = mx - (mx - vb[0]) * scaleAmount;
    const newY = my - (my - vb[1]) * scaleAmount;
    svgMap.setAttribute('viewBox', `${newX} ${newY} ${newW} ${newH}`);
  }, { passive: false });

</script>

</body>
</html>


